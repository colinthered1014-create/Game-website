<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ultimate Clicker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700;900&display=swap" rel="stylesheet">
<style>
  :root{
    --bg1:#0f1724;
    --bg2:#18304a;
    --card: rgba(255,255,255,0.06);
    --accent: #00d1ff;
    --accent-2: #7afcff;
    --muted: rgba(255,255,255,0.7);
    --glass: rgba(255,255,255,0.06);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:Inter,system-ui,Arial;
    background: linear-gradient(135deg,var(--bg1),var(--bg2));
    color: #e6f3ff;
    min-height:100vh;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:20px;
  }

  .wrap{width:100%;max-width:1100px;display:grid;grid-template-columns: 1fr 380px;gap:20px;}
  @media (max-width:980px){.wrap{grid-template-columns: 1fr; padding-bottom:40px}}

  .card{background:var(--card);border-radius:18px;padding:18px;box-shadow:0 8px 30px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);}

  .play-area{display:flex;flex-direction:column;gap:14px;align-items:center;padding:26px;}
  .title{display:flex;width:100%;justify-content:space-between;align-items:center;gap:12px;}
  .title h1{margin:0;font-size:20px;letter-spacing:0.4px;}
  .stats{text-align:right;font-size:13px;color:var(--muted);}

  .big-button{width:230px;height:230px;border-radius:50%;border:none;background: radial-gradient(circle at 35% 25%, var(--accent-2), var(--accent));box-shadow:0 12px 30px rgba(0,210,255,0.12), 0 6px 12px rgba(0,0,0,0.4),0 0 40px rgba(0,210,255,0.08) inset;cursor:pointer;font-weight:900;font-size:28px;color:#041018;transition: transform .08s ease;position:relative;overflow:visible;display:flex;align-items:center;justify-content:center;user-select:none;}
  .big-button:active{transform: scale(.98)}

  .small-row{ display:flex; gap:12px; width:100%; justify-content:center; flex-wrap:wrap; }
  .upgrade{background:var(--glass);padding:12px;border-radius:12px;text-align:left;min-width:180px;max-width:100%;cursor:pointer;border:1px solid rgba(255,255,255,0.03);transition: transform .12s, background .12s;}
  .upgrade:hover{ transform: translateY(-4px); background: rgba(255,255,255,0.09); }
  .upgrade .title { font-weight:700; font-size:14px; }
  .upgrade .meta { font-size:12px; color:var(--muted); margin-top:6px; }

  .row-between { display:flex; justify-content:space-between; align-items:center; gap:10px; }
  .side{display:flex;flex-direction:column;gap:14px;}
  .leaderboard-list, .ach-list{list-style:none;padding:10px;margin:0;display:flex;flex-direction:column;gap:8px;}
  .leader-item{display:flex;justify-content:space-between;align-items:center;background: rgba(255,255,255,0.03);padding:8px;border-radius:8px;font-size:14px;}
  .controls{display:flex;gap:10px;margin-top:8px;flex-wrap:wrap;}
  .btn{padding:8px 12px;border-radius:10px;border:none;background:rgba(255,255,255,0.06);color:inherit;cursor:pointer;}
  .muted{ color:var(--muted); font-size:13px; }
  .mini{font-size:12px;color:var(--muted);}
  .particle{position:absolute;pointer-events:none;font-weight:800;color: #baf7ff;text-shadow: 0 6px 16px rgba(0,0,0,0.45);transform-origin:center;will-change: transform, opacity;}
  footer{ text-align:center; color:var(--muted); font-size:13px; margin-top:12px; }
</style>
</head>
<body>
<div class="wrap">
  <div class="card play-area">
    <div class="title">
      <h1>Ultimate Clicker</h1>
      <div class="stats">
        <div id="clickCount">Clicks: 0</div>
        <div id="perSec" class="mini">+0 / sec</div>
      </div>
    </div>

    <div style="position:relative; width:100%; display:flex; justify-content:center; margin-top:6px;">
      <button id="bigBtn" class="big-button">CLICK</button>
    </div>

    <div class="small-row">
      <div class="upgrade" id="multUpgrade">
        <div class="title">Multiplier</div>
        <div class="meta">Cost: <span id="multCost">10</span> · Multiplier: x<span id="multValue">1.00</span></div>
      </div>

      <div class="upgrade" id="autoUpgrade">
        <div class="title">Auto Clicker</div>
        <div class="meta">Cost: <span id="autoCost">100</span> · Owned: <span id="autoOwned">0</span></div>
      </div>
    </div>

    <div style="width:100%; display:flex; gap:12px; margin-top:12px; flex-wrap:wrap; justify-content:center;">
      <div class="upgrade" id="critUpgrade" style="min-width:260px;">
        <div class="title">Critical Chance</div>
        <div class="meta">Critical chance: <span id="critChance">5%</span> · Crit multiplier: <span id="critMult">x2</span></div>
      </div>

      <div class="upgrade" id="moreUpgrade" style="min-width:260px;">
        <div class="title">Click Power</div>
        <div class="meta">Add +<span id="flatAdd">0</span> flat clicks per click</div>
      </div>
    </div>

    <div style="width:100%; margin-top:12px; display:flex; justify-content:center; gap:10px;">
      <button id="prestigeBtn" class="btn">Prestige</button>
      <button id="resetBtn" class="btn">Reset (keep achievements)</button>
      <button id="syncBtn" class="btn">Sync to Global Leaderboard</button>
    </div>

    <footer class="mini">Saved locally. For global leaderboard, deploy backend and set API URL.</footer>
  </div>

  <div class="card side">
    <div style="display:flex; justify-content:space-between; align-items:center;">
      <strong>Clicker Leaderboard</strong>
      <div class="mini">Top (local) & global</div>
    </div>
    <ol id="localLeaderboard" class="leaderboard-list"></ol>

    <div style="display:flex; gap:10px;">
      <input id="nameInput" placeholder="Your name (global)" style="flex:1; padding:8px; border-radius:8px; border:none; background:rgba(255,255,255,0.03); color:inherit;">
      <button id="submitGlobal" class="btn">Submit</button>
    </div>

    <hr style="border:none; height:1px; background:rgba(255,255,255,0.03); margin:10px 0;">

    <strong>Achievements</strong>
    <ul id="achList" class="ach-list"></ul>

    <div style="margin-top:auto; display:flex; justify-content:space-between; gap:10px; align-items:center;">
      <div class="mini">Prestige multiplier x <span id="prestigeMult">1</span></div>
      <div class="mini">Offline ready: <span id="offlineInfo">0</span> sec</div>
    </div>
  </div>
</div>

<!-- MAIN GAME SCRIPT -->
<script type="module">
const API_URL = ""; // Set to your backend API URL if using global leaderboard
const GAME_KEY = "ultimate-clicker";
const LOCAL_LB_KEY = "clicker_local_lb_v1";

const config = {
  baseMultCost: 10,
  autoBaseCost: 100,
  critBaseChance: 0.05,
  critMult: 2,
  autoGainPer: 1,
  offlineMaxSeconds: 60 * 60 * 24,
};

let state = {
  clicks:0,multiplier:1,multCost:config.baseMultCost,autoOwned:0,autoCost:config.autoBaseCost,
  critChance:config.critBaseChance,critLevel:0,addPerClick:0,flatUpgrades:0,
  prestigeCount:0,earnedPrestigeMult:1,lastTick:Date.now(),achievements:{},particles:[]
};

const $ = id=>document.getElementById(id);
const bigBtn=$("bigBtn"), clickCount=$("clickCount"), perSec=$("perSec"),
multCostEl=$("multCost"), multValueEl=$("multValue"), autoCostEl=$("autoCost"),
autoOwnedEl=$("autoOwned"), critChanceEl=$("critChance"), critMultEl=$("critMult"),
flatAddEl=$("flatAdd"), prestigeBtn=$("prestigeBtn"), prestigeMultEl=$("prestigeMult"),
nameInput=$("nameInput"), submitGlobal=$("submitGlobal"), syncBtn=$("syncBtn"),
resetBtn=$("resetBtn"), multUpgrade=$("multUpgrade"), autoUpgrade=$("autoUpgrade"),
critUpgrade=$("critUpgrade"), moreUpgrade=$("moreUpgrade"),
localLeaderboard=$("localLeaderboard"), achList=$("achList");

function saveState(){localStorage.setItem(GAME_KEY,JSON.stringify(state));updateLocalLeaderboardIfNeeded();}
function loadState(){const s=localStorage.getItem(GAME_KEY);if(s){try{const parsed=JSON.parse(s);state=Object.assign(state,parsed);}catch(e){}}
const now=Date.now();const diff=Math.floor((now-(state.lastTick||now))/1000);state.lastTick=now;
if(diff>0){const sec=Math.min(diff,config.offlineMaxSeconds);const gained=sec*state.autoOwned*config.autoGainPer*state.earnedPrestigeMult;if(gained>0) showFloatingText("+"+gained,200);state.clicks+=gained;} $("offlineInfo").textContent=diff>0?diff:0;}

function formatNum(n){if(n>=1e9)return(n/1e9).toFixed(2)+'B';if(n>=1e6)return(n/1e6).toFixed(2)+'M';if(n>=1e3)return(n/1e1)+'k';return Math.floor(n);}

function showFloatingText(text){const rect=bigBtn.getBoundingClientRect();const x=rect.left+bigBtn.offsetWidth/2;const y=rect.top+80;const el=document.createElement('div');el.className='particle';el.textContent=text;document.body.appendChild(el);
let life=900+Math.random()*400;el.style.left=x+'px';el.style.top=y+'px';el.style.opacity=1;el.style.transform='translateY(0) scale(1)';const start=performance.now();
function tick(now){const t=now-start;const prog=t/life;el.style.transform=`translate(${(Math.random()*120-60)*prog}px, ${-80*prog}px) scale(${1-0.3*prog})`;el.style.opacity=String(1-prog);if(prog<1) requestAnimationFrame(tick);else el.remove();} requestAnimationFrame(tick);}

function updateUI(){
  clickCount.textContent="Clicks: "+formatNum(state.clicks);
  perSec.textContent="+"+formatNum(state.autoOwned*config.autoGainPer*state.earnedPrestigeMult)+" / sec";
  multCostEl.textContent=Math.floor(state.multCost);
  multValueEl.textContent=state.multiplier.toFixed(2);
  autoCostEl.textContent=Math.floor(state.autoCost);
  autoOwnedEl.textContent=state.autoOwned;
  critChanceEl.textContent=Math.round(state.critChance*100)+"%";
  critMultEl.textContent="x"+config.critMult;
  flatAddEl.textContent=state.addPerClick;
  prestigeMultEl.textContent=state.earnedPrestigeMult;
  renderAchievements();renderLocalLeaderboard();saveState();
}

function clickAction(){
  let crit=Math.random()<state.critChance;
  let base=state.multiplier+state.addPerClick;
  let gained=base*state.earnedPrestigeMult;
  if(crit) gained*=config.critMult;
  gained=Math.max(0.01,gained);
  state.clicks+=gained;
  showFloatingText(crit?("CRIT +"+Math.floor(gained)):"+"+Math.floor(gained));
  updateUI();
}

bigBtn.addEventListener('click',clickAction);

setInterval(()=>{const gain=state.autoOwned*config.autoGainPer*state.earnedPrestigeMult;if(gain>0){state.clicks+=gain;if(gain>=1) showFloatingText("+"+formatNum(gain));}updateUI();},1000);

multUpgrade.addEventListener('click',()=>{
  if(state.clicks>=state.multCost){state.clicks-=state.multCost;state.multiplier*=1.1;state.multCost*=1.5;updateUI();} else showFloatingText("Need "+Math.floor(state.multCost-state.clicks));
});

autoUpgrade.addEventListener('click',()=>{
  if(state.clicks>=state.autoCost){state.clicks-=state.autoCost;state.autoOwned+=1;state.autoCost*=1.05;updateUI();} else showFloatingText("Need "+Math.floor(state.autoCost-state.clicks));
});

critUpgrade.addEventListener('click',()=>{
  const cost=200*Math.pow(1.8,state.critLevel);
  if(state.clicks>=cost){state.clicks-=cost;state.critLevel+=1;state.critChance=Math.min(0.5,state.critChance+0.02);updateUI();} else showFloatingText("Need "+Math.floor(cost-state.clicks));
});

moreUpgrade.addEventListener('click',()=>{
  const cost=50*Math.pow(1.6,state.flatUpgrades);
  if(state.clicks>=cost){state.clicks-=cost;state.flatUpgrades+=1;state.addPerClick+=1;updateUI();} else showFloatingText("Need "+Math.floor(cost-state.clicks));
});

prestigeBtn.addEventListener('click',()=>{
  const threshold=10000;if(state.clicks<threshold){alert("Need at least "+threshold+" clicks to prestige."); return;}
  const prestigeGain=Math.floor(state.clicks/threshold);if(!confirm("Prestige will reset your progress but give x"+prestigeGain+" permanent multiplier. Proceed?")) return;
  state.prestigeCount+=prestigeGain;
  state.earnedPrestigeMult=1+0.05*state.prestigeCount;
  state.clicks=0; state.multiplier=1; state.multCost=config.baseMultCost; state.autoOwned=0; state.autoCost=config.autoBaseCost;
  state.critChance=config.critBaseChance; state.critLevel=0; state.addPerClick=0; state.flatUpgrades=0;
  updateUI();
});

resetBtn.addEventListener('click',()=>{
  if(!confirm("Reset all progress and achievements?")) return;
  state={clicks:0,multiplier:1,multCost:config.baseMultCost,autoOwned:0,autoCost:config.autoBaseCost,
  critChance:config.critBaseChance,critLevel:0,addPerClick:0,flatUpgrades:0,
  prestigeCount:0,earnedPrestigeMult:1,lastTick:Date.now(),achievements:{},particles:[]};
  saveState(); updateUI();
});

function updateLocalLeaderboardIfNeeded(){
  const curScore=Math.floor(state.clicks);
  let lb=JSON.parse(localStorage.getItem(LOCAL_LB_KEY)||'[]');
  if(curScore>0){lb.push({name:'You',score:curScore,ts:Date.now()});lb=lb.sort((a,b)=>b.score-a.score).slice(0,10);localStorage.setItem(LOCAL_LB_KEY,JSON.stringify(lb));}
}

function renderLocalLeaderboard(){
  const lb=JSON.parse(localStorage.getItem(LOCAL_LB_KEY)||'[]');
  localLeaderboard.innerHTML='';
  if(lb.length===0){localLeaderboard.innerHTML='<div class="mini muted">No local scores yet — play to generate one.</div>'; return;}
  lb.forEach((it,idx)=>{
    const li=document.createElement('li'); li.className='leader-item';
    li.innerHTML=`<div>#${idx+1} ${it.name}</div><div>${formatNum(it.score)}</div>`;
    localLeaderboard.appendChild(li);
  });
}

loadState(); updateUI();
setInterval(saveState,2000);
window.addEventListener('beforeunload',saveState);
window.addEventListener('keydown',e=>{if(e.key===' '){e.preventDefault();clickAction();}});
</script>

<!-- FIREBASE SCRIPT (module) -->
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.2/firebase-app.js";
  import { getFirestore, collection, addDoc, getDocs, query, orderBy, limit } 
    from "https://www.gstatic.com/firebasejs/10.7.2/firebase-firestore.js";

  const firebaseConfig = { ... };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  async function submitScore(name, score){ ... }
  async function getTopScores(){ ... }

  window.submitScore = submitScore;
  window.getTopScores = getTopScores;
</script>
